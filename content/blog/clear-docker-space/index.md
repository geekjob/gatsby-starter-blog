---
title: "Чистим место на VPS/VDS с докерами"
date: "2018-11-09T16:49:22.000Z"
description: "Заметки на полях У меня архитектура микросервисная и для разных сервисов я люблю брать небольшие облачные инстансы (пользуюсь Si"
---

<h4>Заметки на полях</h4>
<p>У меня архитектура микросервисная и для разных сервисов я люблю брать небольшие облачные инстансы (пользуюсь <a href="https://simplecloud.ru/start/newhr" target="_blank" rel="noopener noreferrer">SimpleCloud</a>). Почему именно они? Пользовался DO, пользовался VSсale, и другими… Но опытным путем пришел к тому, что в соотношении цена-качество-аптайм и удобство работы выигрывает <a href="https://simplecloud.ru/start/newhr" target="_blank" rel="noopener noreferrer">SimpleCloud</a>. У меня почти нет нареканий. За более чем 3 года работы я суммарно писал в службу поддержки раза 4 и все проблемы решались достаточно быстро. Но речь не об этом…</p>
<p>Ну так вот, микросервисы доставляются через контейнеры (ессно Docker). И тут один сервис вдруг говорит — место кончилось. Внезапно. Наверное у многих были случаи в жизни, когда кончается место на сервере. Это случается не часто, но случается. И что делать? Решил выложить шпаргалку, чтобы самому не забыть.</p>
<p>Смотрим кто занял место. Для этого есть несколько способов.</p>
<p>Есть утилита <strong>ncdu</strong>, если вы ее поставили. Если нет — то с нехваткой места вы ее уже не сможете поставить. Она в человеческом виде показывает кто самый “жирный”.</p>
<p>Если просто набрать</p>
<pre>df -h</pre>
<p>Покажет свободное место. Не всегда это может помочь, особенно если вывод выглядит так:</p>
<pre>Filesystem      Size  Used Avail Use% Mounted on<br>/dev/sda1        80G   80G   80G 100% /</pre>
<p>Тогда вы можете пройти от корня командой:</p>
<pre>du -hx --max-depth=1 /</pre>
<p>до тех пор пока не выявите самую большую директорию. В итоге выясняем что место сожрано /var/lib/docker. Так как это девелоп версия сервиса, то по мере разработки, экспериментов и прочих манипуляций на инстансе может собраться склад неиспользуемых данных от контейнеров (особенно если активно собираете контейнеры).</p>
<h3>Чистим следы Docker’a</h3>
<p>Чтобы удалить все неиспользуемое, достаточно выполнить команду:</p>
<pre>$ docker volume prune -f<br>$ docker system prune -af</pre>
<p>В итоге оказалось что 48% диска было занято именно неиспользуемыми данными от старых контейнеров и точек монтирования. Буквально парой команд было вычищено огромное количество мусора.</p>



