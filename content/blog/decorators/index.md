---
title: "Декораторы"
date: "2016-01-20T00:09:17.00Z"
description: "Разбираемся что это и в чем отличия Часть 2. Оператор декорирования Из предыдущей части мы поняли, что декоратор — это удобный с"
---

<!--kg-card-begin: html--><h4>Разбираемся что это и в чем отличия</h4>
<h4>Часть 2. Оператор декорирования</h4>
<p>Из предыдущей части мы поняли, что декоратор — это удобный способ изменения поведения некоторой функции или класса, или объекта. Для того, чтобы декораторами можно было удобно пользоваться, в некоторых языках программирования (например Python или Java*) есть специальные операторы. Javascript не исключение. Данный оператор есть в стандарте ES7 , по синтаксису он похож.</p>
<p>Основная задача декоратора — это расширение функциональности объекта, не используя наследования. Следовательно декораторы необходимо использовать, когда требуется реализовать много независимых расширений и не создавать множество подклассов, что может привести к большой сложности системы.</p>
<p>Синтаксис декораторов пока находится в экспериментальных стадиях. В Babeljs их можно включить так:</p>
<pre>$ npm install babel-plugin-transform-decorators</pre>
<pre>Usage:</pre>
<pre>{<br>  "plugins": ["transform-decorators"]<br>}</pre>
<p>В TypeScript для этого требуется аргумент (или запись в tsconfig.json)</p>
<pre>--experimentalDecorators</pre>
<p>С точки зрения синтаксиса выглядит все достаточно просто. Каждый вызов декоратора начинается с символа <strong>@</strong>. Перепишем наш пример с расчетом стоимости кофе, в зависимости от ингредиентов, с применением синтаксиса ES7 декораторов:</p>
<p><a href="https://gist.github.com/i0z/3f3ca9312714470367c1">https://gist.github.com/i0z/3f3ca9312714470367c1</a></p>
<p>Если не видеть реализацию декораторов, а пользоваться только результатом инкапсуляции, то выходит весьма красиво (и немного магически, если не знать как работает данный механизм).</p>
<pre><strong>@withMilk<br>@withWhip<br>@withSprinkles</strong><br>class Coffee {<br> private cost :number = 1;<br> getCost() :number {<br>   return this.cost;<br> }<br>}</pre>
<pre>var myCoffee = new Coffee();<br>console.log( myCoffee.getCost() );</pre>
<p>Мы, конечно, могли бы сделать тоже самое через наследование, но представьте себе в какой код превратился бы наш пример. Мы могли бы использовать паттерн Композиция, как альтернатива… Но декораторы добавляют новый уровень метапрограммирования, делая код более понятным для чтения. Не таким простым, но зато легким для чтения.</p>
<p>Если бы нам пришлось писать тот же код на ES5, используя функцию декорирования, то это выглядело бы так:</p>
<p><a href="https://gist.github.com/i0z/25ccf18cb2fe782848ff">https://gist.github.com/i0z/25ccf18cb2fe782848ff</a></p>
<p>В TypeScript уже описаны сигнатуры различных декораторов:</p>
<pre>declare type ClassDecorator = &lt;TFunction extends Function&gt;(target: TFunction) =&gt; TFunction | void;</pre>
<pre>declare type PropertyDecorator = (target: Object, propertyKey: string | symbol) =&gt; void;</pre>
<pre>declare type MethodDecorator = &lt;T&gt;(target: Object, propertyKey: string | symbol, descriptor: TypedPropertyDescriptor&lt;T&gt;) =&gt; TypedPropertyDescriptor&lt;T&gt; | void;</pre>
<pre>declare type ParameterDecorator = (target: Object, propertyKey: string | symbol, parameterIndex: number) =&gt; void;</pre>
<p>На основании этих сигнатур TypeScript генерит различные сообщения об ошибках.</p>
<p>Исходя из этих описаний можно понять где могут быть использованы декораторы и аннотации. Они могут быть использованы для:</p>
<ul>
<li>класса</li>
<li>свойства</li>
<li>метода</li>
<li>аргумента</li>
</ul>
<hr>
<h4>Аннотации</h4>
<p>Аннотации — способ добавления метаданных к объявлению класса для использования во внедрении зависимостей или директивах компилятора.</p>
<p>Аннотации были предложены командой разработки языка AtScript из Google, но они не входят в стандарт. Декораторы были предложены в качестве стандарта в ES7 для изменения классов и свойств на этапе разработки.</p>
<p>С точки зрения разработчика у аннотаций и декораторов абсолютно одинаковый синтаксис. Отличие в том, что разработчик не контролирует то, как аннотации добавляют метаданные в код.</p>
<p>Декораторы можно рассматривать как интерфейс для построения чего-то, что ведет себя как аннотации.</p>
<p>Давайте разбираться по порядку. Сначала научимся работать с декораторами и затем плавно перейдем к работе с аннотациями.</p>
<hr>
<h4>Продолжение</h4>

<!--kg-card-end: html-->

