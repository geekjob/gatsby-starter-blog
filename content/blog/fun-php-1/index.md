---
title: "Fun PHP #1"
date: "2018-01-19T18:09:06.00Z"
description: "Особенности поведения    Сегодня говорим про PHP. Задачка первая. Дан код:  <?php  class HR { public $foo = 1; }  $Obj1 = New HR"
---

<h4>Особенности поведения</h4>

<p>Сегодня говорим про PHP. Задачка первая. Дан код:</p>
<pre>&lt;?php</pre>
<pre><strong>class</strong> HR {<br><strong>public</strong> $foo = 1;<br>}<br><br>$Obj1 = <strong>New</strong> HR( Foo.bar() );<br>$Obj2 = <strong>new</strong> stdClass( someDo( $Obj1 ) );<br><br><em>#EOF#</em></pre>
<p>Код дан как есть. Вопрос: что тут происходит и как отработает?</p>
<h3>Ответы</h3>
<p>Код отработает без ошибок, если версия интепретатора 5.6.0–5.6.30, 7.0.0–7.0.27, несмотря на то, что происходит обращение к несуществующему классу и вызов несуществующей функции.</p>
<p>Во всех остальных будет генерироваться ошибка:</p>
<p><a href="https://3v4l.org/T5EAi#v560">https://3v4l.org/T5EAi#v560</a></p>
<h4>Почему так происходит?</h4>
<p>Вы можете сами догадаться, если я изменю код следующим образом:</p>
<pre>&lt;?php</pre>
<pre><strong>class</strong> HR {<br><strong>public</strong> $foo = 1;<br><strong>function</strong> __construct(){}<br>}<br><br>$Obj1 = <strong>New</strong> HR( Foo.bar() );<br>$Obj2 = <strong>new</strong> stdClass( someDo( $Obj1 ) );<br><br><em>#EOF#</em></pre>
<p>Выведет ошибку:</p>
<pre>PHP Notice:  Use of undefined constant Foo - assumed 'Foo' in /experiments/1.php on line 24<br>PHP Fatal error:  Uncaught Error: Call to undefined function bar() in /experiments/1.php:24<br>Stack trace:<br>#0 {main}<br>  thrown in /experiments/1.php on line 24</pre>
<p>Как так? Что происходит?</p>
<p>Все дело в парсере. Если у класса нет конструктора, то зачем парсить код, который передается как аргумент? Значит если нет конструктора, то можно писать любую ахинею и все что угодно и это не влияет на работу и скорость выполнения. Как вы понимаете у базового класса stdClass нет конструктора.</p>
<p>Скорее всего это был багофича, так что обновляйтесь и используйте только свежие версии интепретаторов (в которых могут быть новые баги =)).</p>
<h3>Зачем знать такое?</h3>
<p>Часто слышу в свой адрес что задачи все непрактичные, что этими задачами хрен что проверишь и вообще… Так вот, представьте ситуацию: у вас проект с n-летней историей. У вас сотни тысяч строк кода. Вы делаете рефакторинг и переписываете какой-то API, в результате которого что-то где-то поменялось кардинально. И у вас может сложиться ситуация, когда вы не заметите такие вот “мертвые” куски, причем вы будете думать что они рабочие при отладке. Крышу сносит, когда ты что-то меняешь — а ничего не происходит. А еще сильнее сносит крышу, когда ты видишь что тут вызов функции есть, а функции нигде такой уже давно нет.</p>
<p>Собственно эту задачу я придумал по мотивам реальной истории из своей практики.</p>
<p>И да, обновитесь до последней версии PHP и все будет ок.</p>
<h3>UPD</h3>
<p>В продолжении темы, похожая по духу и поведению задачка:</p>
<p><a href="https://3v4l.org/T5EAi#v560">https://3v4l.org/T5EAi#v560</a></p>


