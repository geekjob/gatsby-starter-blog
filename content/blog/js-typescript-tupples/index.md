---
title: "Кортежи в JavaScript и TypeScript"
date: "2018-04-09T00:19:38.00Z"
description: "Константные структуры    Все никак не могу остановиться говорить про иммутабельность. Дело в том, что буквально недавно закрыли "
---

<!--kg-card-begin: html--><h4>Константные структуры</h4>
<figure>
<p><img data-width="929" data-height="359" src="https://cdn-images-1.medium.com/max/800/1*Y1phlMIvIZEo4GI17Wa0OQ.png"><br />
</figure>
<p>Все никак не могу остановиться говорить про иммутабельность. Дело в том, что буквально недавно закрыли вакансию Node.js TypeScript разработчика в один интересный криптовалютный стартап. И было примечательно то, что собеседующие техлиды очень щепетильно относились к тому, на сколько хорошо кандидат понимает принципы иммутабельности. Это было одним из важнейших критериев. Помимо всего этого от кандидата ожидали хорошей базовой подготовки в computer science, принципов и паттернов ООП, принципов SOLID и прочие вещи. Сегодняшняя статья закрывающая по теме констант и константных неизменяемых объектов.</p>
<p>Один из юзкейсов использования const для объектов — это создание иммутабельной структуры данных. И одна из таких структур — кортеж (tuples).</p>
<p>Сейчас во многих языках программирования существует такая конструкция. Где-то кортежи встроены в язык, а где-то реализуются средствами библиотек. Кортежи есть, например, в языках Erlang, F#, Groovy, Haskell, Lisp, C#, D, Python, Ruby, Go, Rust, Swift и многих других…</p>
<h4>Что такое кортеж?</h4>
<blockquote><p>Кортеж (tuple) — упорядоченный набор фиксированной длины.</p></blockquote>
<h4>Явная реализация кортежа в JavaScript</h4>
<p>Так как в JS нет синтаксической конструкции для объявления кортежа, мы создадим функцию tuple (прям как в Python):</p>
<pre><strong>const </strong>tuple = (...args) =&gt; <strong>Object</strong>.freeze(args);</pre>
<p>Ну вот и все. Пример использования:</p>
<pre><strong>const </strong>tup = <strong>tuple </strong>( 1, 2, 3, 4 );</pre>
<pre>tup[0] = 13; <em>// ничего не произойдет</em></pre>
<pre>console.log( tup ); <em>// [1,2,3,4]</em></pre>
<p>Мы получили неизменяемый список фиксированной длины. Так просто? И ради этой строчки столько TL;DR написано в этой статье? Ну выходит что да. Но ведь мало знать решение, неплохо бы понимать откуда это взялось и зачем может понадобиться.</p>
<h3>Зачем?</h3>
<h4>TL;DR теория и занудство</h4>
<p>И вот вопрос, а зачем эти самые кортежи? В программировании существует множество структур данных, как фиксированной, так и переменной длины которые позволяют хранить как значения одного типа так и разных типов. Всевозможные массивы, ассоциативные массивы, списки, структуры, векторы, словари…</p>
<p>Так зачем еще и кортежи? А в языках со слабой типизацией, в таком как JavaScript, например — и тем более. Разница между кортежами и списками вообще не видна. Разница ощутима в других языках, где кортежи являются встроенными структурами (например в Python) либо в компилируемых языках. В них кортежи являются оптимизированными структурами данных, позволяя не только защищать данные, но и экономить ресурсы.</p>
<p>Если вы вошли в мир программирования с языков со слабой типизацией, все вышесказанное может ввести вас в некоторое заблуждение. Да и действительно, зачем нам кортежи в JavaScript?</p>
<p><strong>Кортеж, как структура данных, примечателен тем, что в него нельзя добавлять элементы, а так же нельзя менять местами элементы и нарушать порядок следования.</strong></p>
<p>В языках программирования со статической типизацией кортеж отличается от списка тем, что элементы кортежа могут принадлежать разным типам и набор таких типов заранее определён типом кортежа, а значит и размер кортежа также определён. С другой стороны, коллекции (списки, массивы) имеют ограничение по типу хранимых элементов, но не имеют ограничения на длину. Такое можно реализовать в TypeScript. Но сейчас речь о ванильном JS.</p>
<p>Лично мое мнение в том, что с ростом интереса к функциональному подходу и иммутабельным данным стоит знать и про такие структуры данных как кортежи и их разновидности, так же как надо знать паттерны ООП. JS — это мультипарадигменный язык, поэтому в него занесли много интересного из разных миров. Но главное в том, что кортежи легко можно реализовать в JavaScript.</p>
<h3>Неявные кортежи в JavaScript</h3>
<p>На самом деле вы уже используете кортежи в JavaScript неявно и даже не подозреваете об этом. Кортежи неявно используются во всех языках программирования, даже в Си и Ассемблере.</p>
<blockquote><p>Список аргументов функции или список инициализации массива является неявным кортежем</p></blockquote>
<p>Список аргументов функции является кортежем. Ведь список аргументов — это список фиксированной длины. В функциональных языках некаррированные функции нескольких аргументов принимают параметры в виде одного аргумента, являющегося кортежем.</p>
<p>Список инициализации массива — это тоже кортеж. Даже обычный блок кода — это тоже кортеж. Только элементами его являются не значения или объекты, а синтаксические конструкции.</p>
<h3>Пара — частный случай кортежа</h3>
<p>В С++ есть частный случай реализации кортежа — структура данных, называемая пара. Как понятно из названия пара может содержать только 2 значения, в то время как кортеж — любое количество.</p>
<p>Реализация пары на JavaScript:</p>
<pre><strong>const </strong>pair = (...args) =&gt; <strong>Object</strong>.freeze( args.slice(0,2) );<br>// или так, ведь мы знаем что у нас могут быть только 2 аргумента<br><strong>const</strong> pair = (x, y) =&gt; <strong>Object</strong>.freeze([x, y]);</pre>
<p>Пример использования:</p>
<pre><strong>const </strong>par = pair ( 1, 2, 3 ); <em>// 3 не добавится</em></pre>
<pre>par[0] = 3; <em>// нельзя изменить</em><br>par[4] = 4; <em>// нельзя добавить</em></pre>
<pre>console.log(par); <em>// [1,2]</em></pre>
<h3>Кортежи в TypeScript</h3>
<p>TypeScript позволяет затипизировать структуру данных и дает нам возможность описать кортеж, содержащий разные типы. Допустим мы хотим кортеж, который содержит сразу два типа:</p>
<pre><strong>const</strong> myTuple: [<strong>string</strong>, <strong>number</strong>] = ['foo', 123];</pre>
<pre>myTuple[0] = 123; // Type '123' is not assignable to type 'string'.</pre>
<p>Так же кортеж можно описать через интефейс, расширив базовый тип Array:</p>
<pre><strong>interface</strong> MyTuple&lt;T,U&gt; <strong>extends</strong> <strong>Array</strong>&lt;T|U&gt; {<br>    0: T;<br>    1: U;<br>}</pre>
<pre><strong>const</strong> mytuple: MyTuple&lt;<strong>boolean</strong>, <strong>number</strong>&gt; = [true, 123];</pre>
<p>Таким образом можно создавать списки с фиксированными типами. Но если вспомнить что такое кортеж — это упорядоченный набор фиксированной длины. А у нас получились объекты, в которые можно добавить новые элементы.</p>
<h4>Упорядоченный набор фиксированной длины</h4>
<p>Мы можем указать длину нашего кортежа и TS будет проверять ее:</p>
<pre><strong>interface</strong> MyTuple <strong>extends</strong> <strong>Array</strong>&lt;<strong>number</strong> | <strong>string</strong>&gt; {<br>    0: number;<br>    1: string;<br>    length: 2; // это литеральный тип '2', это не значение!<br>}</pre>
<pre><strong>const</strong> mytuple: MyTuple = [123, 'abc', 'foo'];</pre>
<pre><em>// Type '[number, string, string]' is not assignable to type 'Tuple'. Types of property 'length' are incompatible. Type '3' is not assignable to type '2'.</em></pre>
<p>Как видите, TS говорит нам, что мы не можем объявить кортеж с тремя элементами, так как мы заявили всего 2. Но, как помните из предыдущих упоминаний, все это артефакты. Поэтому для рантайма нам нужно добавить заморозку объекта.</p>
<p>Если вы хотите создать настоящий кортеж, описанный по всем правилам, чтобы TypeScript помог вам защититься на этапе разработки, а так же защитить его в рантайме, вам нужно описывать кортежи следующим образом:</p>
<pre><strong>interface</strong> MyTuple <strong>extends</strong> <strong>ReadonlyArray</strong>&lt;<strong>string</strong>|<strong>number</strong>&gt; {<br>    0: <strong>string</strong>;<br>    1: <strong>number</strong>;<br>    length: 2;<br>}</pre>
<pre><strong>const</strong> tup: MyTuple = &lt;MyTuple&gt;<strong>Object</strong>.freeze(['foo', 123]);<br>// или<br><strong>const</strong> tup: MyTuple = <strong>Object</strong>.freeze(['foo', 123]) <strong>as</strong> MyTuple;<br>// или<br><strong>const</strong> tup: MyTuple = ['foo', 123]; <strong>Object</strong>.freeze(tup);</pre>
<p>Описание кортежа таким способом дает следующие преимущества:</p>
<ul>
<li>нельзя создать изначально кортеж больше заданной длины</li>
</ul>
<pre><strong>const</strong> tup: MyTuple = &lt;MyTuple&gt;<strong>Object</strong>.freeze(['foo', 123, 456]);</pre>
<pre>Type '[string, number, number]' is not assignable to type 'MyTuple'.<br>  Types of property 'length' are incompatible.<br>    Type '3' is not assignable to type '2'.</pre>
<ul>
<li>типы элементов упорядочены и их нельзя менять местами</li>
</ul>
<pre>tup[0] = 123;</pre>
<pre>Type '123' is not assignable to type 'string'</pre>
<ul>
<li>нельзя модифицировать существующие элементы</li>
<li>нельзя добавлять новые элементы</li>
</ul>
<pre>tup[3] = 456;</pre>
<pre>Index signature in type 'MyTuple' only permits reading</pre>
<h3>The END</h3>
<p>На сегодня TypeScript стал очень популярным и его выбирают бэкенд разработчики на разных языках со строгой и явной типизацией. Поэтому есть отдельные вакансии TypeScript разработчиков.</p>
<!--kg-card-end: html-->

