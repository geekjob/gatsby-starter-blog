---
title: "Правильная математика в ES6+"
date: "2016-11-21T13:23:45.00Z"
description: "0.1 + 0.2 === 0.3 Наверняка вы уже сталкивались с тем, что в JS арифметика с числами не всегда выдает ожидаемый результат, в сил"
---

<!--kg-card-begin: html--><h4>0.1 + 0.2 === 0.3</h4>
<p>Наверняка вы уже сталкивались с тем, что в JS арифметика с числами не всегда выдает ожидаемый результат, в силу особенностей работы с числами. Например:</p>
<pre>0.1 * 0.2<br>0.020000000000000004</pre>
<pre>0.3 - 0.1<br>0.19999999999999998</pre>
<p>Т.е. если мы просто напишем логику, в которое однажды произойдет следующее условие:</p>
<pre>0.1 + 0.2 === 0.3<br><strong>false</strong></pre>
<p>То наше условие не сработает. Как быть?</p>
<h3>Машинное эпсилон округление</h3>
<p>Машинное эпсилон было введено в ES6.</p>
<blockquote><p>
<strong>Машинный ноль</strong> — числовое значение с таким отрицательным порядком, которое воспринимается машиной как ноль.</p></blockquote>
<blockquote><p>
<strong>Машинное эпсилон</strong> — числовое значение, меньше которого невозможно задавать относительную точность для любого алгоритма, возвращающего вещественные числа. Абсолютное значение «машинного эпсилон» зависит от разрядности сетки, типа (разрядности) используемых при расчетах чисел, и от принятой в конкретном трансляторе структуры представления вещественных чисел (количества бит, отводимых на мантиссу и на порядок). Формально машинное эпсилон обычно определяют как минимальное из чисел eps, для которого 1+eps&gt;1 при машинных расчетах с числами данного типа. Альтернативное определение — максимальное положительное eps, для которого справедливо равенство 1+eps=1.</p></blockquote>
<blockquote><p>Практическая важность машинного эпсилон связана с тем, что два (отличных от нуля) числа являются одинаковыми с точки зрения машинной арифметики, если их относительная разность по модулю меньше (при определении первого типа) или не превосходит (при определении второго типа) машинного эпсилон.</p></blockquote>
<p>Машинное эпсилон округление обеспечивает разумный предел погрешности при сравнении двух чисел с плавающей точкой.</p>
<h4>Реализуем функцию equal</h4>
<pre><strong>const</strong> eq = (a, b) =&gt;<br><strong>Math</strong>.abs(a-b) &lt; <strong>Number</strong>.EPSILON * <strong>Math</strong>.max(<strong>Math</strong>.abs(a),<strong>Math</strong>.abs(b))<br>;<br><strong>eq</strong>(.1 + .2, .3) <em>// true</em></pre>
<!--kg-card-end: html-->

