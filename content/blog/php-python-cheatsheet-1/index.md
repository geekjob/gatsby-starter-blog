---
title: "PHP/Python cheatsheet #1"
date: "2018-07-12T16:36:49.000Z"
description: "«__main__» == __name__ in PHP Когда пишешь на нескольких языках, начинаешь привносить в код разные практики из других ЯП. Я буду"
---

<h4>&#171;__main__&#187; == __name__ in PHP</h4>
<p>Когда пишешь на нескольких языках, начинаешь привносить в код разные практики из других ЯП. Я буду писать для себя шпаргалки и мелкие заметки по теме как реализовать то-то и то-то в PHP, Python, Node.js.</p>
<p>В python скриптах есть устоявшаяся практика, как я понял, вызывать код, если дергается сам скрипт и быть библиотекой, если скрипт импортится куда-то. Пример:</p>
<pre><strong>def</strong> main():<br>    ...some code...<br>    #end<br><br></pre>
<pre><strong>if</strong> "<em>__main__</em>" == <strong>__name__</strong>:<br>    main()</pre>
<p>Мне понравилась эта практика и захотелось такое же делать и в PHP. Раньше даже как-то в голову не приходило так использовать скрипты. Если очень хочется, то такое же поведение в PHP можно реализовать кодом:</p>
<pre>&lt;?php <strong>declare</strong>(strict_types=1);</pre>
<pre><strong>function</strong> main() {<br>    ...some code...<br>}</pre>
<pre><strong>if</strong> ($argv[0] == basename(<strong>__FILE__</strong>)) {<br>    main();<br>}</pre>
<p>Минус именно этого варианта и бага кроется в том, что если этот скрипт будет заимпортирован в файл с точно таким же именем, то это условие так же сработает. Это надо учитывать. Поэтому модифицируем код таким образом:</p>
<pre><strong>if</strong> ( <strong>realpath</strong>($argv[0]) == <strong>__FILE__</strong>  ) {<br>}</pre>
<p>Теперь мы делаем проверку по полному пути к файлу. Вот теперь работает без ошибок. Есть еще один вариант, который я видел в сети, это проверка через количество в бэктрейсе:</p>
<pre><strong>if</strong> (count(<code><strong>debug_backtrace</strong>()</code>) &lt;  1) {...}<br>// or<br><strong>if</strong> (!count(<code><strong>debug_backtrace</strong>()</code>)) {...}<br>// or<br><strong>if</strong> (!<code><strong>debug_backtrace</strong>()</code>) {...}</pre>
<p>Вариант интересен и даже рабочий, но есть вероятность непредсказуемого поведения если поменяется API функции или вдруг функция будет переопределена (в PHP можно переопределять даже системные функции через специальное расширение).</p>


